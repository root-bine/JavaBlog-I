## 1ã€<span style="color:brown">çº¿ç¨‹åŒæ­¥ï¼š</span>

**1.1ã€åº”ç”¨åœºæ™¯ï¼š**

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸€æ—¦å¼€å¯å¤šä¸ªçº¿ç¨‹å°±ä¼šå¯¼è‡´<u>å¤šä¸ªçº¿ç¨‹åœ¨éšæœºè®¿é—®CPU</u>ï¼Œå¹¶<u>å¯¹å…±äº«æ•°æ®è¿›è¡Œä¿®æ”¹</u>ï¼Œäº§ç”Ÿ**è„æ•°æ®**ï¼Œæœ€ç»ˆäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

---

çº¿ç¨‹åŒæ­¥æŠ€æœ¯ï¼Œä¸»è¦æ˜¯**è§£å†³å¤šä¸ªçº¿ç¨‹åœ¨å­˜åœ¨å…±äº«æ•°æ®çš„æƒ…å†µ**ä¸‹ï¼Œå¼€å¯å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚`ç°åœ¨å­˜åœ¨çª—å£1ã€çª—å£2ã€çª—å£3å¯¹CPUè¿›è¡Œè®¿é—®ï¼Œåœ¨çª—å£1è®¿é—®æ—¶ï¼Œçª—å£2ã€çª—å£3åœ¨å¤–é¢ç­‰å¾…ï¼Œç›´åˆ°çª—å£1ç»“æŸä¸ºæ­¢ã€‚`

**1.2ã€å¦‚ä½•å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ**ğŸ˜¶â€ğŸŒ«ï¸ğŸ˜¶â€ğŸŒ«ï¸ğŸ˜¶â€ğŸŒ«ï¸

1. åŒæ­¥ä»£ç å—ï¼›
2. åŒæ­¥æ–¹æ³•ï¼›
3. ReentrantLockï¼›
4. volatileï¼›
5. åŸå­å˜é‡ï¼›



## 2ã€<span style="color:brown">åŒæ­¥ä»£ç å—ï¼š</span>

**2.1ã€æ ¼å¼ï¼š**

```java
synchronized(åŒæ­¥é”){
	éœ€è¦åŒæ­¥æ“ä½œçš„ä»£ç ;
}
```

**2.2ã€åŒæ­¥é”ï¼š**é”å¯¹è±¡

1. å¯¹è±¡çš„åŒæ­¥é”åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå¯ä»¥ç†è§£ä¸ºï¼š<u>åœ¨å¯¹è±¡ä¸Šæ ‡è®°ä¸€ä¸ªé”</u>ï¼›
2. é”çš„å¯¹è±¡å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼›
3. <u>å¤šä¸ªçº¿ç¨‹å¯¹è±¡è¦ä½¿ç”¨åŒä¸€æŠŠé”</u>ï¼›
4. é”å¯¹è±¡çš„ä½œç”¨ï¼š<u>*æŠŠåŒæ­¥ä»£ç å—é”ä½ï¼Œåªè®©ä¸€ä¸ªçº¿ç¨‹åœ¨ä»£ç å—ä¸­å¯åŠ¨*</u>ï¼›

**2.3ã€èŒƒä¾‹ï¼š**

```java
public class RunnableImpl implements Runnable{
    //å®šä¹‰ä¸€ä¸ªå¤šçº¿ç¨‹çš„å…±äº«æ•°æ®ç¥¨æº
    private int ticket = 100;
    //åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡
    Object object = new Object();
    //è®¾ç½®çº¿ç¨‹ä»»åŠ¡ï¼šå–ç¥¨
    @Override
    public void run() {
        //ä½¿ç”¨æ­»å¾ªç¯ï¼Œè®©å–ç¥¨æ“ä½œé‡å¤è¿›è¡Œ
        while(true){
            //åŒæ­¥ä»£ç å—
            synchronized(object){
                //å…ˆåˆ¤æ–­ç¥¨æ˜¯å¦å­˜åœ¨
                if(ticket > 0){
                    //æé«˜å®‰å…¨é—®é¢˜å‡ºç°çš„æ¦‚ç‡ï¼Œä½¿ç¨‹åºç¡çœ 
                    try {
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    //ç¥¨å­˜åœ¨ï¼Œå–ç¥¨ï¼Œticket--
                    System.out.println(Thread.currentThread().getName()+"æ­£åœ¨ä¹°ç¬¬"+ticket+"ç¥¨");
                    ticket--;
                }
            }
        }
    }
}
```

```java
public class Demo01 {
    public static void main(String[] args) {
        //åˆ›å»ºRunnableæ¥å£å®ç°ç±»å¯¹è±¡
        RunnableImpl run = new RunnableImpl();
        //åˆ›å»ºThreadå¯¹è±¡ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä¼ é€’Runnableæ¥å£å®ç°ç±»å¯¹è±¡
        Thread t1 = new Thread(run);
        Thread t2 = new Thread(run);
        Thread t3 = new Thread(run);
        //å¯åŠ¨çº¿ç¨‹
        t1.start();
        t2.start();
        t3.start();
    }
}
```



## 3ã€<span style="color:brown">åŒæ­¥æ–¹æ³•ï¼š</span>

**3.1ã€åŒæ­¥æ–¹æ³•æ ¼å¼ï¼š**

> æ™®é€šåŒæ­¥æ–¹æ³•

```java
ä¿®é¥°ç¬¦ synchronized è¿”å›å€¼ç±»å‹ æ–¹æ³•åç§°(å‚æ•°åˆ—è¡¨){
    å¯èƒ½ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨çš„ä»£ç ;
}
```

> é™æ€åŒæ­¥æ–¹æ³•

```java
ä¿®é¥°ç¬¦ static synchronized è¿”å›å€¼ç±»å‹ æ–¹æ³•åç§°(å‚æ•°åˆ—è¡¨){
    å¯èƒ½ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨çš„ä»£ç ;
}
```

**3.2ã€åŒæ­¥æ–¹æ³•ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŸç†ï¼š**

é€šè¿‡*é”å¯¹è±¡*æŠŠ<u>æ–¹æ³•å†…éƒ¨çš„ä»£ç é”ä½</u>ï¼Œåªè®©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚

è€Œä¸¤ç§åŒæ­¥æ–¹æ³•çš„é”å¯¹è±¡ä¹Ÿæœ‰æ‰€åŒºåˆ«ï¼š

```scss
æ™®é€šåŒæ­¥æ–¹æ³•çš„é”å¯¹è±¡: new RunnableImpl(), ä¹Ÿå°±æ˜¯this
```

```scss
é™æ€åŒæ­¥æ–¹æ³•çš„é”å¯¹è±¡: RunnableImpl.class;
```

**3.3ã€èŒƒä¾‹ï¼š**

```java
public class RunnableImpl implements Runnable{
    private int ticket = 100;
    @Override
    public void run() {
        while(true){
            payTicket();
        }
    }
    //å®šä¹‰ä¸€ä¸ªåŒæ­¥æ–¹æ³•
    public synchronized void payTicket(){
        //æ­¤å¤„çš„åŒæ­¥ä»£ç å—ï¼Œä¸»è¦æ˜¯è¡¨æ˜åŒæ­¥æ–¹æ³•çš„é”å¯¹è±¡
        synchronized (new RunnableImpl()/*RunnableImpl.class*/){
            if(ticket > 0){
                //æé«˜å®‰å…¨é—®é¢˜å‡ºç°çš„æ¦‚ç‡ï¼Œä½¿ç¨‹åºç¡çœ 
                try {
                    Thread.sleep(10);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                //ç¥¨å­˜åœ¨ï¼Œå–ç¥¨ï¼Œticket--
                System.out.println(Thread.currentThread().getName()+"æ­£åœ¨ä¹°ç¬¬"+ticket+"ç¥¨");
                ticket--;
            }
        }
    }
}

```

```java
public class Demo01 {
    public static void main(String[] args) {
        //åˆ›å»ºRunnableæ¥å£å®ç°ç±»å¯¹è±¡
        RunnableImpl run = new RunnableImpl();
        //åˆ›å»ºThreadå¯¹è±¡ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä¼ é€’Runnableæ¥å£å®ç°ç±»å¯¹è±¡
        Thread t2 = new Thread(run);
        Thread t1 = new Thread(run);
        Thread t3 = new Thread(run);
        //å¯åŠ¨çº¿ç¨‹
        t1.start();
        t2.start();
        t3.start();
    }
}
```



## 4ã€<span style="color:brown">Locké”ï¼š</span>

**4.1ã€æ¦‚è¿°ï¼š**

1. `java.util.concurrent.locks.Lockæ¥å£`æä¾›äº†æ¯”åŒæ­¥ä»£ç å—å’ŒåŒæ­¥æ–¹æ³•æ›´å¹¿æ³›çš„é”æ“ä½œï¼›
2. `java.util.concurrent.locks.ReentrantLock implements Lockæ¥å£`ï¼›

**4.2ã€Lockæ¥å£çš„æ–¹æ³•ï¼š**

```java
void lock()
    è·å–é”;
```

```java
void unlock()
    é‡Šæ”¾é”;
```

```java
boolean tryLock()
    å°è¯•è·å–é”, è¿”å›ä¸€ä¸ªbooleanå€¼;
```

```java
boolean tryLock(long time, TimeUnit unit) 
    å°è¯•è·å–é”, å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´;
```

**4.3ã€ä½¿ç”¨æ­¥éª¤ï¼š**

1. åˆ›å»ºä¸€ä¸ªRunnableæ¥å£çš„å®ç°ç±»ï¼Œé‡å†™runæ–¹æ³•ï¼Œè®¾ç½®çº¿ç¨‹ä»»åŠ¡ï¼›
2. åœ¨å®ç°ç±»ï¼Œå®šä¹‰ReenTrantLockå¯¹è±¡ï¼›

3. åœ¨å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨çš„ä»£ç å‰ï¼Œè°ƒç”¨Lockæ¥å£ä¸­çš„lockæ–¹æ³•è·å–é”ï¼›

4. åœ¨å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨çš„ä»£ç åï¼Œè°ƒç”¨Lockæ¥å£ä¸­çš„lockæ–¹æ³•è·å–é”ï¼›

**4.4ã€èŒƒä¾‹ï¼š**

```java
public class RunnableImpl implements Runnable{
    //å®šä¹‰ä¸€ä¸ªå¤šçº¿ç¨‹çš„å…±äº«æ•°æ®ç¥¨æº
    private int ticket = 100;
    //åˆ›å»ºä¸€ä¸ªReentrantLockå¯¹è±¡
    Lock l = new ReentrantLock();
    //è®¾ç½®çº¿ç¨‹ä»»åŠ¡ï¼šå–ç¥¨
    @Override
    public void run() {
        //ä½¿ç”¨æ­»å¾ªç¯ï¼Œè®©å–ç¥¨æ“ä½œé‡å¤è¿›è¡Œ
        while(true){
            l.lock();
            //å…ˆåˆ¤æ–­ç¥¨æ˜¯å¦å­˜åœ¨
            if(ticket > 0){
                //æé«˜å®‰å…¨é—®é¢˜å‡ºç°çš„æ¦‚ç‡ï¼Œä½¿ç¨‹åºç¡çœ 
                try {
                    Thread.sleep(10);
                    //ç¥¨å­˜åœ¨ï¼Œå–ç¥¨ï¼Œticket--
                    System.out.println(Thread.currentThread().getName()+"æ­£åœ¨ä¹°ç¬¬"+ticket+"ç¥¨");
                    ticket--;
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }finally{
                    l.unlock();
                }
            }
        }
    }
}
```

```java
public class Demo01 {
    public static void main(String[] args) {
        //åˆ›å»ºRunnableæ¥å£å®ç°ç±»å¯¹è±¡
        RunnableImpl run = new RunnableImpl();
        //åˆ›å»ºThreadå¯¹è±¡ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä¼ é€’Runnableæ¥å£å®ç°ç±»å¯¹è±¡

        Thread t2 = new Thread(run);
        Thread t1 = new Thread(run);
        Thread t3 = new Thread(run);
        //å¯åŠ¨çº¿ç¨‹
        t1.start();
        t2.start();
        t3.start();
    }
}
```